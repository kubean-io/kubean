# kubean测试用例

| 功能点         | 用例名称                                         | 备注                                     | 基线       | 是否完成 | 代码链接 | 详细说明                                                                                          |
| ---------------- |----------------------------------------------|----------------------------------------| ------------ | ---------- | ---------- |-----------------------------------------------------------------------------------------------|
| 创建基础集群   | 创建集群: master and worker in 1 node            | master and worker in one node          | C-001      | | | [detail](./testcase_details/create_cluster.md#create-basic-cluster)                           |
|                | 支持k8s:1.24                                   |                                        | C-012      |          |          | [detail](./testcase_details/create_cluster.md#create-basic-cluster)                           |
|                | 支持CRI:containerd                             |                                        | C-013      |<ul><li>[x] </li></ul>| [代码链接](../../test/kubean_functions_e2e/kubean_cluster_install_test.go)| [detail](./testcase_details/create_cluster.md#create-basic-cluster)                           |
|                | 支持CNI:calico                                 | legacy                                 | C-001/N-37 |          |          | [detail](./testcase_details/create_cluster.md#create-basic-cluster)                           |
|                | 支持calico的IPIP                                |                                        |            |          |          | [detail](./testcase_details/create_cluster.md#create-basic-cluster)                           |
|                | 创建集群时不覆盖写hostname                            | override_system_hostname=false         | C-001      |          |          | [detail](./testcase_details/create_cluster.md#create-basic-cluster)                           |
|                | 集群证书自动更新                                     | auto_renew_certificates<br />暂时先默认关闭该功能 | C-015      |          |          | [detail](./testcase_details/create_cluster.md#create-basic-cluster)                           |
|                | ssh授权方式:用户名密码                                |                                        |            |          |          | [detail](./testcase_details/create_cluster.md#create-basic-cluster)                           |
| 创建集群：扩展 | 创建单节点集群：1 master and 1 woker                 |                                        |            | <ul><li>[x] </li></ul> | [代码链接](../../test/kubean_sonobouy_e2e/kubean_cluster_sonobouy_test.go) | [detail](./testcase_details/create_cluster.md#create-cluster-with-one-master-and-one-worker)  |
|                | 创建高可用集群                                      | 3master + 2 worker                     | C-012      |          |          |                                                                                               |
|                | 支持k8s:1.22                                   |                                        | C-012      |          |          |                                                                                               |
|                | 支持k8s:1.23                                   |                                        | C-012      |          |          |                                                                                               |
|                | 支持CRI:docker                                 |                                        | C-001      | <ul><li>[x] </li></ul> | [代码链接](../../test/kubean_sonobouy_e2e/kubean_cluster_sonobouy_test.go) |                                                                                               |
|                | SSH授权方式：秘钥                                   |                                        |            |          |          |                                                                                               |
|                | 支持CRI:Cillium                                | cillium对内核有要求：centos8 + NTF            | C-001      |          |          |                                                                                               |
|                | 支持calico的Vxlan                               |                                        | C-001      |          |          |                                                                                               |
|                | 支持calico的IPIP_CrossSubnet                    |                                        | C-001      |          |          |                                                                                               |
|                | 支持calico的Vxlan_CrossSubnet                   |                                        | C-001      |          |          |                                                                                               |
|                | 集群节点跨子网                                      |                                        | C-001      |          |          |                                                                                               |
|                | 使用CRI:runc                                   |                                        | C-042      |          |          |                                                                                               |
|                | 使用CRI:kata                                   |                                        | C-042      |          |          |                                                                                               |
|                | 使用CRI:gvisor                                 |                                        | C-042      |          |          |                                                                                               |
|                | 支持用户定义pods网段                                 | kube_pods_subnet                       | C-001      |          |          |                                                                                               |
|                | 支持用户定义服务网段                                   | kube_service_addresses                 | C-001      |          |          |                                                                                               |
|                | 创建集群时覆盖写hostname                             | override_system_hostname=true          | C-001      | <ul><li>[x] </li></ul> |[代码链接](../../test/kubean_sonobouy_e2e/kubean_cluster_sonobouy_test.go) | [detail](./testcase_details/create_cluster.md#create-cluster-override-hostname)               |
|                | 公有云部署                                        | 低优先级                                   | C-001      |          |          |                                                                                               |
|                | 私有云部署                                        | 低优先级                                   | C-001      |          |          |                                                                                               |
| reset          | 集群reset                                      |                                        |            |          |          |                                                                                               |
|                | 安装失败重试backoffLimit=0                         |                                        |            |          |          |                                                                                               |
|                | 安装失败重试backoffLimit=1                         |                                        |            |          |          |                                                                                               |
|                | 安装失败重试backoffLimit=2                         |                                        |            |          |          |                                                                                               |
| 集群功能       | posthook 回传kubeconfig                        | kubean集群中已经存在同名的需要回传的configmap   |            |          |          | [detail](./testcase_details/kubean_func.md#posthook-cluster-kubeconfig)                       |
|                | 集群并发操作限制                                     |                                        |            |          |          |                                                                                               |
|                | 备份资源的逆序删除                                    | 默认保留10份                                |            |          |          |                                                                                               |
|                | 备份资源的防修改标志能够正确设置                             |                                        |            |          |          |                                                                                               |
| 集群扩缩容     | 新增master节点，服务不中断                             |                                        | C-004      |          |          |                                                                                               |
|                | 新增worker节点，服务不中断                             |                                        | C-004      |          |          |                                                                                               |
|                | 删除在线master节点，服务不中断                           |                                        | C-004      |          |          |                                                                                               |
|                | 删除离线master节                                  |                                        | C-004      |          |          |                                                                                               |
|                | 删除在线worker节点，服务不中断                           |                                        | C-004      |          |          |                                                                                               |
|                | 删除离线worker节点                                 |                                        | C-004      |          |          |                                                                                               |
|                | 删除在线master节点过程中，master节点<br />宕机后能够再继续实现离线删除 | 删除过程中宕机后的删除节点能够提供解决方案                  | C-004      |          |          |                                                                                               |
|                | 删除在线worker节点过程中，worker节点宕机后能够再继续实现离线删除       |                                        | C-004      |          |          |                                                                                               |
|                | 可手动更新集群证书                                    | kubeadmin renew                        | C-015      |          |          |                                                                                               |
| 热升级         | 在线升级K8S的Z版本，服务不中断                            |                                        | C-003      |          |          |                                                                                               |
|                | 在线升级K8S的Y版本，服务不中断                            |                                        | C-003      |          |          |                                                                                               |
|                | 离线升级k8s的Y版本和Z版本，服务不中断                        |                                        | C-003      |          |          |                                                                                               |
|                | 网络组件升级，服务不中断                                 |                                        | C-003      |          |          |                                                                                               |
|                | 网络组件降级，服务不中断                                 |                                        | C-003      |          |          |                                                                                               |
|                | 升级CRI-Containerd版本，服务不中断                     |                                        | C-003      |          |          |                                                                                               |
|                | 升级CRI-docker版本，服务不中断                         |                                        | C-003      |          |          |                                                                                               |
|                | 升级网络方案，服务不中断（CNI,Metricserver,dns)           |                                        | C-003      |          |          |                                                                                               |
| 高可用         | 非首要master的宕机                                 |                                        | L-019      |          |          |                                                                                               |
|                | 非首要master的高可用                                |                                        | L-019      |          |          |                                                                                               |
|                | 非首要master的高可用-磁盘占满                           |                                        | L-019      |          |          |                                                                                               |
|                | 非首要master的高可用-CPU                            |                                        | L-019      |          |          |                                                                                               |
|                | 非首要master的高可用-MEM                            |                                        | L-019      |          |          |                                                                                               |
|                | 非首要master的高可用-网络不稳定                          |                                        | L-019      |          |          |                                                                                               |
|                | master的etcd高可用-leader                        |                                        | L-019      |          |          |                                                                                               |
|                | master的etcd高可用-follower                      |                                        | L-019      |          |          |                                                                                               |
|                | worker节点高可用                                  |                                        | L-018      |          |          |                                                                                               |
|                | 首要master的高可用-需要确认                            |                                        | L-019      |          |          |                                                                                               |
| 兼容性部署     | arm与x86混合部署                                  | arm只考虑kylin os                         |            |          |          |                                                                                               |
|                | kylin的CRI支持                                  |                                        |            |          |          |                                                                                               |
|                | 硬件加速器                                        |                                        |            |          |          |                                                                                               |
|                | GPU虚拟化                                       |                                        |            |          |          |                                                                                               |
| 其他           | 提供安装说明文档                                     |                                        | C-002      |          |          |                                                                                               |
|                | 安装完成后能够查看集群的安装详细信息                           |                                        | C-002      |          |          |                                                                                               |
|                | 创建集群过程中可以查看到集群状态和日志                          |                                        | C-002      |          |          |                                                                                               |
