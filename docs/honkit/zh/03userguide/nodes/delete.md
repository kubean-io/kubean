# 集群节点缩容（基于 KubeSpray）

当集群需要进行集群规模调整，您可将部分节点卸载，卸载后，应用将无法继续运行在此节点上，本章节介绍如何进行集群节点缩容。



**注意：**

1. 当前集群节点缩容只能逐个进行节点卸载。

2. 如需卸载集群控制器节点，请确保最终控制器节点数为 **基数**。 

3. 集群节点缩容时不可下线 **第一个控制器** 节点，如必须进行此操作，请联系售后工程师。

## 前提条件

- 容器管理平台[已创建 Kubernetes 集群](https://ndx.gitpages.daocloud.io/engineering/kpanda/zh/07UserGuide/Workloads/CreateDeploymentByImage.html)，且能够访问集群的 UI 界面。
- 操作用户已授权为 `Cluster Admin` 角色 ，详情可参考[集群授权](https://ndx.gitpages.daocloud.io/engineering/kpanda/zh/07UserGuide/Workloads/CreateDeploymentByImage.html)。
- 节点卸载前，请确认节点已暂停调度，并且此节点上的应用都已驱逐至其他节点。

  - 驱逐方式：登录控制器节点，通过 kubectl drain 命令驱逐节点上所有 Pod ，安全驱逐的方式将会允许容器组里面的容器执行优雅的中止。

## 添加节点操作步骤

### 1. 登录平台

`Cluster Admin` 用户根据下表的信息成功登录后，点击左上角的`集群列表`进入`集群列表`页面。

| 参数                   | 说明                                                         | 举例值                   |
| :--------------------- | :----------------------------------------------------------- | :----------------------- |
| UI 账户和密码          | 【类型】必填 【含义】用来登录容器管理平台 Web UI 的管理员账户和密码 | 账户：root 密码：***\*** |
| 容器平台的 Web UI 地址 | 【类型】必填 【含义】容器管理平台的 Web UI 的 IP 地址        | 10.6.124.110             |

### 2. 节点添加

1. 点击一个集群名称，进入`集群详情`。

2. 点击左侧的`节点管理`进入节点列表。

3. 点击列表后的 `...`

4. 选择`移除节点`进入节点移除弹框页面。

   ![image-20220623135543269](/Users/daiqiuping/Library/Application Support/typora-user-images/image-20220623135543269.png)

5. 进入节点卸载页面，输入节点名称，并点击 `确认`进行删除。

   
