# 集群节点扩容（基于 KubeSpray）

随着业务应用不断增长，当集群资源随着业务规模的扩大造成资源紧张时，您可以对集群节点进行扩容，扩容后，应用可运行在新增节点上。

以下介绍如何进行集群节点扩容。

注意：

1. 可批量添加 控制器节点/工作节点，不可同时进行 控制器节点和 工作节点混合添加。
2. 基于 Kubespray 的 Etcd 和 Controller 部署在相同节点上，扩缩容节点时， Controller 和 ETCD 同时进行。
3.  Controller 添加时，请确保 Controller 节点数为基数，以防发生脑裂问题。

3. 集群节点缩容时不可下线 **第一个控制器** 节点，如必须进行此操作，请联系售后工程师。

## 前提条件

- 容器管理平台[已创建 Kubernetes 集群](https://ndx.gitpages.daocloud.io/engineering/kpanda/zh/07UserGuide/Workloads/CreateDeploymentByImage.html)，且能够访问集群的 UI 界面。

- 操作用户已授权为 `Cluster Admin` 角色 ，详情可参考[集群授权](https://ndx.gitpages.daocloud.io/engineering/kpanda/zh/07UserGuide/Workloads/CreateDeploymentByImage.html)。

  

  

## 添加节点操作步骤

### 1. 登录平台

`Cluster Admin` 用户根据下表的信息成功登录后，点击左上角的`集群列表`进入`集群列表`页面。

| 参数                   | 说明                                                         | 举例值                   |
| :--------------------- | :----------------------------------------------------------- | :----------------------- |
| UI 账户和密码          | 【类型】必填 【含义】用来登录容器管理平台 Web UI 的管理员账户和密码 | 账户：root 密码：***\*** |
| 容器平台的 Web UI 地址 | 【类型】必填 【含义】容器管理平台的 Web UI 的 IP 地址        | 10.6.124.110             |

### 2. 节点添加

1. 点击一个集群名称，进入`集群详情`。

2. 点击左侧的`节点管理`进入节点列表。

3. 点击右上角`加入节点`

4. 按钮，进入节点添加页面。

   ![image-20220623101238409](/Users/daiqiuping/Library/Application Support/typora-user-images/image-20220623101238409.png)

5. 进入节点添加页面，选择”角色类型“，并输入节点名称，节点 IP 信息，可批量输入，请确保输入的 Hostname 和 IP 地址没有冲突。

   | 参数     | 说明                                                         | 举例值       |
   | :------- | :----------------------------------------------------------- | :----------- |
   | 角色类型 | 【类型】必填 <br />【含义】选择添加节点的角色类型，可添加角色有”控制器节点“、”工作节点“，可批量添加相同角色节点<br />如添加控制器节点，默认添加节点上会启用一个 ETCD | 工作节点     |
   | 节点名称 | 【类型】必填 <br />【含义】节点的 Hostname ，输入前请确认 Hostname 的正确性 | Node01       |
   | IP 地址  | 【类型】必填 <br />【含义】节点的 IP 地址                    | 10.6.124.110 |

   6. 输入上述信息后，点击 `验证`后开始进行节点检测，主要检测项如下：

      1. IP 联通性，自动检测 节点 IP 是否联通
      2. HostName 一致性，检测输入的 HostName 同节点配置的是一致的
      3. OS 兼容性，检测节点的 OS 是否同安装的 k8s 版本是否兼容
      4. NTP 时间同步，检测节点事件同 NTP 时间是否同步

   7. 如上述检测项都已通过，节点会自动添加至集群，整个添加过程约 20 分钟，请耐心等待，如需要查看具体 节点添加过程及日志，请查看 [Recently Operations]()

      
