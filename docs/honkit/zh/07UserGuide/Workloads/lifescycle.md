
# 容器生命周期配置

在创建工作负载时，通常使用镜像来指定容器中的运行环境。默认情况下， Docker 镜像在构建时，可以通过 “Entrypoint” 和 "CMD" 两个字段来定义容器运行时执行的命令和参数。如果需要更改容器镜像启动前、启动后、停止前的命令和参数，您可以通过设置容器的生命周期事件命令和参数，来覆盖镜像中默认的命令和参数。

本节介绍如何配置容器的生命周期。

## 前提条件

- 容器管理平台[已接入 Kubernetes 集群]()或者[已创建 Kubernetes]()，且能够访问集群的 UI 界面
- 已完成一个[命名空间的创建]()、[用户的创建]()，并将用户授权为`NS Edit`角色 ，详情可参考[命名空间授权]()

## 操作步骤

### 步骤 1  登录平台

`NS Edit` 用户根据下表的信息成功登录后，点击左上角的`集群列表`进入`集群列表`页面。

| 参数                    | 说明                                                         | 举例值                       |
| :---------------------- | :----------------------------------------------------------- | :--------------------------- |
| UI 账户和密码          | 【类型】必填<br />【含义】用来登录容器管理平台 Web UI 的管理员账户和密码 | 账户：root<br />密码：****** |
| 容器平台的 Web UI 地址 | 【类型】必填<br />【含义】容器管理平台的 Web UI 的 IP 地址   | 10.6.124.110                 |

### 步骤 2  镜像创建

1. 点击一个集群名称，进入`集群详情`。
2. 点击左侧的`工作负载`进入工作负载列表
3. 点击右上角`镜像创建`按钮，打开工作负载创建页面。

### 步骤 3  生命周期配置

进入部署页面，按照规范填写完基本信息后，您可以根据业务需要对容器的启动命令、启动后命令、停止前命令进行配置。

| 参数      | 说明                                                         | 举例值                                            |
| :-------- | :----------------------------------------------------------- | :------------------------------------------------ |
| 启动命令 | 【类型】选填<br />【含义】容器将按照启动命令进行启动。 |                                     |
| 启动后命令 | 【类型】选填<br />【含义】容器启动后出发的命令<br /> |                                      |
| 停止前命令 | 【类型】选填<br />【含义】容器在收到停止命令后执行的命令。确保升级或实例删除时可提前将实例中运行的业务排水。 |                                         |

#### 启动命令

根据下表对启动命令进行配置。

| 参数     | 说明                                                         | 举例值      |
| :------- | :----------------------------------------------------------- | :---------- |
| 运行命令 | 【类型】必填<br />【含义】输入可执行的命令，多个命令之间用空格进行分割，如命令本身带空格，则需要加（“”）。<br />【含义】多命令时，运行命令建议用/bin/sh或其他的shell，其他全部命令作为参数来传入。 | /run/server |
| 运行参数 | 【类型】选填<br />【含义】输入控制容器运行命令参数。<br />   | port=8080   |

#### 启动后命令

DCE 提供命令行脚本和 HTTP 请求两种处理类型对启动后命令进行配置。您可以根据下表选择适合您的配置方式。

**命令行脚本配置

| 参数     | 说明                                                         | 举例值      |
| :------- | :----------------------------------------------------------- | :---------- |
| 运行命令 | 【类型】选填<br />【含义】输入可执行的命令，多个命令之间用空格进行分割，如命令本身带空格，则需要加（“”）。<br />【含义】多命令时，运行命令建议用/bin/sh或其他的shell，其他全部命令作为参数来传入。 | /run/server |
| 运行参数 | 【类型】选填<br />【含义】输入控制容器运行命令参数。<br />   | port=8080   |

#### 停止前命令

DCE 提供命令行脚本和 HTTP 请求两种处理类型对停止前命令进行配置。您可以根据下表选择适合您的配置方式。**HTTP 请求配置****

| 参数     | 说明                                                         | 举例值      |
| :------- | :----------------------------------------------------------- | :---------- |
| URL 路径 | 【类型】选填<br />【含义】请求的URL路径。<br />【含义】多命令时，运行命令建议用/bin/sh或其他的shell，其他全部命令作为参数来传入。 | /run/server |
| 端口     | 【类型】必填<br />【含义】请求的端口。<br />                 | port=8080   |
| 节点地址 | 【类型】选填<br />【含义】请求的 IP 地址，默认是容器所在的节点 IP。<br /> |             |

#### **HTTP 请求配置****

| 参数     | 说明                                                         | 举例值      |
| :------- | :----------------------------------------------------------- | :---------- |
| URL 路径 | 【类型】选填<br />【含义】请求的URL路径。<br />【含义】多命令时，运行命令建议用/bin/sh或其他的shell，其他全部命令作为参数来传入。 | /run/server |
| 端口     | 【类型】必填<br />【含义】请求的端口。<br />                 | port=8080   |
| 节点地址 | 【类型】选填<br />【含义】请求的 IP 地址，默认是容器所在的节点 IP。<br /> |             |

